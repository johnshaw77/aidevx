<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Runner â€” æ™ºæ…§å·¥å» ç”Ÿç”¢ç·šéŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f0f23);
            color: #ffffff;
            overflow: hidden;
            user-select: none;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* æ¨™é¡Œæ¬„ */
        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #00d4ff;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }

        .score-display {
            display: flex;
            gap: 30px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
        }

        .score-label {
            font-size: 12px;
            color: #aaa;
        }

        /* ç”Ÿç”¢ç·šå€åŸŸ */
        .factory-area {
            flex: 1;
            position: relative;
            background: #2a2a3e;
            overflow: hidden;
        }

        .conveyor-belt {
            position: absolute;
            bottom: 200px;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(90deg, #444 0%, #666 50%, #444 100%);
            border-top: 3px solid #888;
            border-bottom: 3px solid #888;
        }

        .belt-pattern {
            position: absolute;
            top: 50%;
            left: 0;
            width: 200%;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #ffff00 0px,
                #ffff00 20px,
                transparent 20px,
                transparent 40px
            );
            transform: translateY(-50%);
            animation: belt-move 1s linear infinite;
        }

        @keyframes belt-move {
            0% { transform: translateX(0) translateY(-50%); }
            100% { transform: translateX(-40px) translateY(-50%); }
        }

        .product {
            position: absolute;
            bottom: 215px;
            width: 40px;
            height: 50px;
            background: linear-gradient(45deg, #00ff88, #00aa55);
            border: 2px solid #ffffff;
            border-radius: 4px;
            transition: all 0.1s ease;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .product.defect {
            background: linear-gradient(45deg, #ff4444, #aa2222);
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 2px solid #00d4ff;
        }

        .control-group {
            text-align: center;
        }

        .control-button {
            background: linear-gradient(145deg, #4a4a6a, #2a2a4a);
            border: 2px solid #00d4ff;
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-weight: bold;
        }

        .control-button:hover {
            background: linear-gradient(145deg, #5a5a7a, #3a3a5a);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .control-button.active {
            background: linear-gradient(145deg, #00d4ff, #0099cc);
            color: #000;
        }

        .speed-display {
            font-size: 18px;
            color: #00ff88;
            margin: 10px 0;
        }

        .indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 5px;
        }

        .indicator.green { background: #00ff88; }
        .indicator.red { background: #ff4444; }
        .indicator.yellow { background: #ffaa00; }

        /* éŠæˆ²é–‹å§‹/çµæŸç•«é¢ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .overlay-content {
            background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #00d4ff;
        }

        .start-button {
            background: linear-gradient(145deg, #00ff88, #00aa55);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .instructions {
            text-align: left;
            margin: 20px 0;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- æ¨™é¡Œæ¬„ -->
        <div class="header">
            <div class="title">ğŸ­ Factory Runner</div>
            <div class="score-display">
                <div class="score-item">
                    <div class="score-value" id="production">0</div>
                    <div class="score-label">ç”¢é‡</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="quality">100%</div>
                    <div class="score-label">è‰¯ç‡</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="score">0</div>
                    <div class="score-label">åˆ†æ•¸</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="timer">60</div>
                    <div class="score-label">æ™‚é–“</div>
                </div>
            </div>
        </div>

        <!-- ç”Ÿç”¢ç·šå€åŸŸ -->
        <div class="factory-area">
            <div class="conveyor-belt">
                <div class="belt-pattern"></div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="control-group">
                <div>å‚³é€å¸¶é€Ÿåº¦</div>
                <button class="control-button" onclick="changeSpeed(-1)">æ¸›é€Ÿ</button>
                <div class="speed-display" id="speed-display">ä¸­é€Ÿ</div>
                <button class="control-button" onclick="changeSpeed(1)">åŠ é€Ÿ</button>
            </div>

            <div class="control-group">
                <div>å“è³ªæª¢æ¸¬</div>
                <button class="control-button" id="quality-btn" onclick="toggleQuality()">é–‹å•Ÿæª¢æ¸¬</button>
                <div>
                    <span class="indicator green"></span>
                    <span class="indicator" id="quality-indicator"></span>
                </div>
            </div>

            <div class="control-group">
                <div>è¨­å‚™ç¶­ä¿®</div>
                <button class="control-button" id="repair-btn" onclick="repairMachine()">ç¶­ä¿®è¨­å‚™</button>
                <div>
                    <span class="indicator" id="machine-indicator"></span>
                    æ©Ÿå™¨ç‹€æ…‹
                </div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²é–‹å§‹ç•«é¢ -->
    <div class="overlay" id="start-overlay">
        <div class="overlay-content">
            <h1>ğŸ­ Factory Runner</h1>
            <h3>æ™ºæ…§å·¥å» ç”Ÿç”¢ç·šç®¡ç†éŠæˆ²</h3>
            
            <div class="instructions">
                <p><strong>éŠæˆ²ç›®æ¨™ï¼š</strong> åœ¨60ç§’å…§ç²å¾—æœ€é«˜åˆ†æ•¸</p>
                <br>
                <p><strong>æ“ä½œèªªæ˜ï¼š</strong></p>
                <p>â€¢ <strong>å‚³é€å¸¶é€Ÿåº¦</strong>ï¼šå½±éŸ¿ç”¢é‡ï¼Œé€Ÿåº¦è¶Šå¿«ç”¢é‡è¶Šé«˜</p>
                <p>â€¢ <strong>å“è³ªæª¢æ¸¬</strong>ï¼šé–‹å•Ÿå¾Œæå‡è‰¯ç‡ï¼Œä½†é™ä½ç”¢é‡</p>
                <p>â€¢ <strong>è¨­å‚™ç¶­ä¿®</strong>ï¼šæ©Ÿå™¨æ•…éšœæ™‚éœ€è¦ç¶­ä¿®</p>
                <br>
                <p><strong>è¨ˆåˆ†å…¬å¼ï¼š</strong> ç”¢é‡ Ã— è‰¯ç‡ Ã— é€Ÿåº¦åŠ æˆ</p>
            </div>

            <button class="start-button" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸç•«é¢ -->
    <div class="overlay" id="end-overlay" style="display: none;">
        <div class="overlay-content">
            <h1>ğŸ¯ éŠæˆ²çµæŸ</h1>
            <h2 id="final-score">æœ€çµ‚åˆ†æ•¸ï¼š0</h2>
            <div id="performance-analysis"></div>
            <button class="start-button" onclick="restartGame()">å†ä¾†ä¸€å±€</button>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            isRunning: false,
            timeLeft: 60,
            production: 0,
            defectCount: 0,
            score: 0,
            beltSpeed: 1, // 0: æ…¢, 1: ä¸­, 2: å¿«
            qualityControl: false,
            machineHealth: 100,
            products: []
        };

        const speedSettings = [
            { name: 'æ…¢é€Ÿ', multiplier: 0.5, production: 1 },
            { name: 'ä¸­é€Ÿ', multiplier: 1, production: 2 },
            { name: 'å¿«é€Ÿ', multiplier: 1.5, production: 3 }
        ];

        let gameInterval, productInterval;

        // é–‹å§‹éŠæˆ²
        function startGame() {
            document.getElementById('start-overlay').style.display = 'none';
            resetGame();
            gameState.isRunning = true;
            
            // ä¸»è¦éŠæˆ²å¾ªç’°
            gameInterval = setInterval(() => {
                updateTimer();
                updateMachine();
                updateUI();
                calculateScore();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            // ç”¢å“ç”Ÿç”¢å¾ªç’°
            productInterval = setInterval(() => {
                if (gameState.machineHealth > 0) {
                    createProduct();
                }
            }, 2000 / speedSettings[gameState.beltSpeed].production);
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            gameState.timeLeft = 60;
            gameState.production = 0;
            gameState.defectCount = 0;
            gameState.score = 0;
            gameState.machineHealth = 100;
            gameState.products = [];
            
            // æ¸…é™¤æ‰€æœ‰ç”¢å“
            document.querySelectorAll('.product').forEach(p => p.remove());
        }

        // å‰µå»ºç”¢å“
        function createProduct() {
            const product = document.createElement('div');
            product.className = 'product';
            
            // åˆ¤æ–·æ˜¯å¦ç‚ºä¸è‰¯å“
            let defectChance = 0.2; // åŸºç¤ä¸è‰¯ç‡20%
            if (gameState.beltSpeed === 2) defectChance += 0.15; // å¿«é€Ÿå¢åŠ 15%
            if (gameState.qualityControl) defectChance *= 0.3; // å“æª¢é™ä½70%
            if (gameState.machineHealth < 50) defectChance += 0.2; // æ©Ÿå™¨æ•…éšœå¢åŠ 20%
            
            const isDefect = Math.random() < defectChance;
            if (isDefect) {
                product.classList.add('defect');
            }
            
            product.style.left = '-50px';
            document.querySelector('.factory-area').appendChild(product);
            
            gameState.products.push({
                element: product,
                isDefect: isDefect,
                processed: false
            });
            
            // ç§»å‹•ç”¢å“
            moveProduct(product, isDefect);
        }

        // ç§»å‹•ç”¢å“
        function moveProduct(product, isDefect) {
            let position = -50;
            const speed = 2 * speedSettings[gameState.beltSpeed].multiplier;
            
            const moveInterval = setInterval(() => {
                position += speed;
                product.style.left = position + 'px';
                
                // ç”¢å“åˆ°é”çµ‚é»
                if (position > window.innerWidth) {
                    clearInterval(moveInterval);
                    product.remove();
                    
                    // è¨ˆç®—ç”¢é‡
                    gameState.production++;
                    if (isDefect) {
                        gameState.defectCount++;
                    }
                }
            }, 50);
        }

        // æ›´æ–°è¨ˆæ™‚å™¨
        function updateTimer() {
            gameState.timeLeft--;
        }

        // æ›´æ–°æ©Ÿå™¨ç‹€æ…‹
        function updateMachine() {
            // æ©Ÿå™¨éš¨æ©Ÿæ•…éšœ
            if (Math.random() < 0.05) {
                gameState.machineHealth = Math.max(0, gameState.machineHealth - 10);
            }
        }

        // è¨ˆç®—åˆ†æ•¸
        function calculateScore() {
            const qualityRate = gameState.production > 0 ? 
                ((gameState.production - gameState.defectCount) / gameState.production) : 1;
            
            const speedBonus = speedSettings[gameState.beltSpeed].multiplier;
            const qualityBonus = gameState.qualityControl ? 1.2 : 1;
            
            gameState.score = Math.floor(gameState.production * qualityRate * 100 * speedBonus * qualityBonus);
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('production').textContent = gameState.production;
            
            const qualityRate = gameState.production > 0 ? 
                ((gameState.production - gameState.defectCount) / gameState.production * 100) : 100;
            document.getElementById('quality').textContent = qualityRate.toFixed(1) + '%';
            
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('timer').textContent = gameState.timeLeft;
            
            // æ›´æ–°é€Ÿåº¦é¡¯ç¤º
            document.getElementById('speed-display').textContent = speedSettings[gameState.beltSpeed].name;
            
            // æ›´æ–°æŒ‡ç¤ºç‡ˆ
            const qualityIndicator = document.getElementById('quality-indicator');
            qualityIndicator.className = 'indicator ' + (gameState.qualityControl ? 'green' : 'red');
            
            const machineIndicator = document.getElementById('machine-indicator');
            if (gameState.machineHealth > 70) {
                machineIndicator.className = 'indicator green';
            } else if (gameState.machineHealth > 30) {
                machineIndicator.className = 'indicator yellow';
            } else {
                machineIndicator.className = 'indicator red';
            }
            
            // æ›´æ–°å‚³é€å¸¶å‹•ç•«é€Ÿåº¦
            const beltPattern = document.querySelector('.belt-pattern');
            const animationDuration = 1 / speedSettings[gameState.beltSpeed].multiplier;
            beltPattern.style.animationDuration = animationDuration + 's';
        }

        // æ”¹è®Šé€Ÿåº¦
        function changeSpeed(direction) {
            gameState.beltSpeed = Math.max(0, Math.min(2, gameState.beltSpeed + direction));
            
            // æ›´æ–°ç”¢å“ç”Ÿç”¢é–“éš”
            clearInterval(productInterval);
            productInterval = setInterval(() => {
                if (gameState.machineHealth > 0) {
                    createProduct();
                }
            }, 2000 / speedSettings[gameState.beltSpeed].production);
        }

        // åˆ‡æ›å“è³ªæª¢æ¸¬
        function toggleQuality() {
            gameState.qualityControl = !gameState.qualityControl;
            const btn = document.getElementById('quality-btn');
            btn.textContent = gameState.qualityControl ? 'é—œé–‰æª¢æ¸¬' : 'é–‹å•Ÿæª¢æ¸¬';
            btn.classList.toggle('active', gameState.qualityControl);
        }

        // ä¿®ç†æ©Ÿå™¨
        function repairMachine() {
            if (gameState.machineHealth < 100) {
                gameState.machineHealth = Math.min(100, gameState.machineHealth + 30);
                
                // ç¶­ä¿®å‹•ç•«æ•ˆæœ
                const btn = document.getElementById('repair-btn');
                btn.textContent = 'ç¶­ä¿®ä¸­...';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.textContent = 'ç¶­ä¿®è¨­å‚™';
                    btn.disabled = false;
                }, 1000);
            }
        }

        // çµæŸéŠæˆ²
        function endGame() {
            gameState.isRunning = false;
            clearInterval(gameInterval);
            clearInterval(productInterval);
            
            // é¡¯ç¤ºçµæœ
            const finalScoreEl = document.getElementById('final-score');
            finalScoreEl.textContent = `æœ€çµ‚åˆ†æ•¸ï¼š${gameState.score}`;
            
            // åˆ†æè¡¨ç¾
            const analysisEl = document.getElementById('performance-analysis');
            const qualityRate = gameState.production > 0 ? 
                ((gameState.production - gameState.defectCount) / gameState.production * 100) : 100;
            
            let performance = '';
            if (gameState.score > 5000) performance = 'ğŸ† å·¥å» ç¶“ç†ç´šåˆ¥ï¼';
            else if (gameState.score > 3000) performance = 'ğŸ¯ å„ªç§€çš„ç”Ÿç”¢ç®¡ç†ï¼';
            else if (gameState.score > 1500) performance = 'ğŸ‘ ä¸éŒ¯çš„è¡¨ç¾ï¼';
            else performance = 'ğŸ’ª é‚„æœ‰æ”¹é€²ç©ºé–“ï¼';
            
            analysisEl.innerHTML = `
                <p><strong>è¡¨ç¾è©•åƒ¹ï¼š</strong> ${performance}</p>
                <p>ç¸½ç”¢é‡ï¼š${gameState.production} ä»¶</p>
                <p>è‰¯å“ç‡ï¼š${qualityRate.toFixed(1)}%</p>
                <p>å¹³å‡é€Ÿåº¦ï¼š${speedSettings[gameState.beltSpeed].name}</p>
            `;
            
            document.getElementById('end-overlay').style.display = 'flex';
        }

        // é‡æ–°é–‹å§‹
        function restartGame() {
            document.getElementById('end-overlay').style.display = 'none';
            startGame();
        }

        // åˆå§‹åŒ–UI
        updateUI();
    </script>
</body>
</html>