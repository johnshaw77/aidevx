<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPC æ™ºæ…§å·¥å» 3Då¯è¦–åŒ– | Smart Factory 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #0a0e1f 0%, #1a1e2f 25%, #0f1a2e 50%, #162030 75%, #0a0e1f 100%);
            color: #00ffff;
            overflow: hidden;
            cursor: none;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .hud-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .top-bar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff;
            border-radius: 25px;
            padding: 15px 30px;
            backdrop-filter: blur(20px);
            text-align: center;
        }

        .top-bar h1 {
            font-size: 1.8rem;
            color: #00ffff;
            text-shadow: 0 0 20px #00ffff;
            margin-bottom: 5px;
        }

        .top-bar .subtitle {
            font-size: 0.9rem;
            color: #40e0d0;
            opacity: 0.8;
        }

        .left-panel {
            position: absolute;
            left: 20px;
            top: 120px;
            width: 280px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(20px);
            pointer-events: auto;
        }

        .right-panel {
            position: absolute;
            right: 20px;
            top: 120px;
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(20px);
            pointer-events: auto;
        }

        .bottom-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            border-radius: 25px;
            padding: 15px 25px;
            backdrop-filter: blur(20px);
            pointer-events: auto;
        }

        .panel-section {
            margin-bottom: 20px;
        }

        .panel-section h3 {
            color: #00ffff;
            font-size: 1rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ffff;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            padding-bottom: 5px;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .data-label {
            color: #40e0d0;
        }

        .data-value {
            color: #00ffff;
            font-weight: bold;
            text-shadow: 0 0 5px #00ffff;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .status-warning {
            background: #ffaa00;
            box-shadow: 0 0 10px #ffaa00;
        }

        .status-offline {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #40e0d0);
            border-radius: 3px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .control-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            text-shadow: 0 0 5px #00ffff;
        }

        .control-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: #00ffff;
            color: #000;
        }

        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.9rem;
            text-shadow: 0 0 5px #00ffff;
            z-index: 100;
            transition: all 0.3s ease;
            pointer-events: auto;
        }

        .home-btn:hover {
            background: #00ffff;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        .loading-screen.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #00ffff;
            font-size: 1.2rem;
            text-shadow: 0 0 10px #00ffff;
        }

        .cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid #00ffff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            transition: all 0.1s ease;
            mix-blend-mode: difference;
        }

        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ ğŸ“± */
        @media (max-width: 768px) {
            /* éš±è—è‡ªè¨‚æ¸¸æ¨™ï¼Œç”¨å›ç³»çµ±æ¸¸æ¨™ */
            body { cursor: auto; }
            .cursor { display: none; }

            /* é ‚éƒ¨æ¨™é¡Œèª¿æ•´ */
            .top-bar {
                top: 10px;
                left: 10px;
                right: 10px;
                width: auto;
                transform: none;
                padding: 10px 15px;
            }

            .top-bar h1 {
                font-size: 1.2rem;
            }

            .top-bar .subtitle {
                font-size: 0.75rem;
            }

            /* å·¦å³é¢æ¿æ”¹ç‚ºå‚ç›´å †ç–Š */
            .left-panel, .right-panel {
                position: absolute;
                left: 10px;
                right: 10px;
                width: auto;
                max-height: 40vh;
                overflow-y: auto;
                font-size: 0.8rem;
            }

            .left-panel {
                top: 80px;
            }

            .right-panel {
                bottom: 100px;
                max-height: 30vh;
            }

            /* åº•éƒ¨æ§åˆ¶æŒ‰éˆ•èª¿æ•´ */
            .bottom-controls {
                bottom: 10px;
                left: 10px;
                right: 10px;
                width: auto;
                transform: none;
                flex-wrap: wrap;
                gap: 8px;
                padding: 10px;
            }

            .control-btn {
                padding: 12px 20px; /* å¢å¤§è§¸æ§å€åŸŸ */
                font-size: 0.85rem;
                min-height: 44px; /* Apple å»ºè­°çš„æœ€å°è§¸æ§å€åŸŸ */
            }

            /* é¦–é æŒ‰éˆ•èª¿æ•´ */
            .home-btn {
                top: 10px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.8rem;
            }

            /* è¨­å‚™åˆ—è¡¨å„ªåŒ– */
            .equipment-list {
                max-height: 150px;
            }

            .equipment-item {
                padding: 10px;
                margin-bottom: 5px;
            }

            /* æ•¸æ“šé …ç›®å„ªåŒ– */
            .data-item {
                font-size: 0.8rem;
                margin-bottom: 6px;
            }

            /* é¢æ¿æ¨™é¡Œç¸®å° */
            .panel-section h3 {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }
        }

        /* è¶…å°å±å¹•ï¼ˆæ‰‹æ©Ÿæ©«å‘/å°æ‰‹æ©Ÿï¼‰ */
        @media (max-width: 480px) {
            .top-bar h1 {
                font-size: 1rem;
            }

            .left-panel, .right-panel {
                padding: 15px;
            }

            .control-btn {
                font-size: 0.75rem;
                padding: 10px 15px;
            }

            .data-item {
                font-size: 0.75rem;
            }
        }

        .equipment-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .equipment-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .equipment-item:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .equipment-name {
            flex: 1;
            font-size: 0.8rem;
            color: #40e0d0;
        }

        .equipment-status {
            font-size: 0.75rem;
            color: #00ffff;
        }

        @media (max-width: 768px) {
            .left-panel, .right-panel {
                width: 250px;
            }
            
            .top-bar h1 {
                font-size: 1.4rem;
            }
            
            .bottom-controls {
                flex-wrap: wrap;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <a href="../index.html" class="home-btn">â† é›¢é–‹å·¥å» </a>
        
        <div class="cursor" id="cursor"></div>
        
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-spinner"></div>
            <div class="loading-text">åˆå§‹åŒ–æ™ºæ…§å·¥å» ç³»çµ±...</div>
        </div>

        <div class="hud-overlay">
            <div class="top-bar">
                <h1>FPC æ™ºæ…§å·¥å» é‹ç‡Ÿç®¡æ§å¹³å°</h1>
                <div class="subtitle">Flexible Printed Circuit Smart Factory Management System</div>
            </div>

            <div class="left-panel">
                <div class="panel-section">
                    <h3>ğŸ­ ç”Ÿç”¢ç‹€æ…‹ç›£æ§</h3>
                    <div class="data-item">
                        <span class="data-label">ç”¢ç·šé‹è¡Œ:</span>
                        <span class="data-value" id="runningLines">3/4</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">æ•´é«”æ•ˆç‡:</span>
                        <span class="data-value" id="overallEfficiency">92.5%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92.5%" id="efficiencyBar"></div>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ä»Šæ—¥ç”¢é‡:</span>
                        <span class="data-value" id="todayOutput">12,847</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">è‰¯ç‡:</span>
                        <span class="data-value" id="yieldRate">96.2%</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>âš™ï¸ è¨­å‚™ç‹€æ…‹</h3>
                    <div class="equipment-list">
                        <div class="equipment-item" onclick="focusEquipment('line1')">
                            <span class="status-indicator status-online"></span>
                            <span class="equipment-name">Aç·š-æ›å…‰æ©Ÿ</span>
                            <span class="equipment-status">é‹è¡Œä¸­</span>
                        </div>
                        <div class="equipment-item" onclick="focusEquipment('line2')">
                            <span class="status-indicator status-online"></span>
                            <span class="equipment-name">Bç·š-è•åˆ»ç·š</span>
                            <span class="equipment-status">é‹è¡Œä¸­</span>
                        </div>
                        <div class="equipment-item" onclick="focusEquipment('line3')">
                            <span class="status-indicator status-warning"></span>
                            <span class="equipment-name">Cç·š-å£“åˆæ©Ÿ</span>
                            <span class="equipment-status">å¾…æ©Ÿä¸­</span>
                        </div>
                        <div class="equipment-item" onclick="focusEquipment('line4')">
                            <span class="status-indicator status-online"></span>
                            <span class="equipment-name">Dç·š-æª¢æ¸¬ç«™</span>
                            <span class="equipment-status">é‹è¡Œä¸­</span>
                        </div>
                        <div class="equipment-item" onclick="focusEquipment('storage')">
                            <span class="status-indicator status-online"></span>
                            <span class="equipment-name">è‡ªå‹•å€‰å„²</span>
                            <span class="equipment-status">æ­£å¸¸</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="panel-section">
                    <h3>ğŸ“Š å¯¦æ™‚æ•¸æ“šåˆ†æ</h3>
                    <div class="data-item">
                        <span class="data-label">ç³»çµ±æº«åº¦:</span>
                        <span class="data-value" id="systemTemp">24.5Â°C</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">èƒ½è€—ç›£æ§:</span>
                        <span class="data-value" id="powerUsage">1,247 kW</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ç¶²è·¯å»¶é²:</span>
                        <span class="data-value" id="networkLatency">12ms</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ä½œæ¥­äººå“¡:</span>
                        <span class="data-value" id="workerCount">38äºº</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>ğŸ¯ å“è³ªæŒ‡æ¨™</h3>
                    <div class="data-item">
                        <span class="data-label">é¦–æ¬¡é€šéç‡:</span>
                        <span class="data-value" id="firstPassRate">94.8%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 94.8%" id="qualityBar"></div>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å®¢æˆ¶æ»¿æ„åº¦:</span>
                        <span class="data-value" id="customerSat">4.7/5.0</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">æº–æ™‚äº¤è²¨:</span>
                        <span class="data-value" id="onTimeDelivery">98.3%</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>ğŸ”” ç³»çµ±è­¦ç¤º</h3>
                    <div class="data-item">
                        <span class="data-label">å¾…è™•ç†äº‹ä»¶:</span>
                        <span class="data-value" id="pendingAlerts">2</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ç³»çµ±ç‹€æ…‹:</span>
                        <span class="data-value" style="color: #00ff00;">æ­£å¸¸é‹è¡Œ</span>
                    </div>
                </div>
            </div>

            <div class="bottom-controls">
                <button class="control-btn active" onclick="setViewMode('overview')">ç¸½è¦½è¦–è§’</button>
                <button class="control-btn" onclick="setViewMode('production')">ç”Ÿç”¢ç·šè¦–è§’</button>
                <button class="control-btn" onclick="setViewMode('quality')">å“è³ªç›£æ§</button>
                <button class="control-btn" onclick="setViewMode('logistics')">ç‰©æµè¿½è¹¤</button>
                <button class="control-btn" onclick="toggleAnimation()">å‹•ç•«æ•ˆæœ</button>
                <button class="control-btn" onclick="exportView()">å°å‡ºè¦–åœ–</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let scene, camera, renderer, controls;
        let buildings = [], equipment = [], particles = [];
        let animationEnabled = true;
        let currentViewMode = 'overview';
        let mouseX = 0, mouseY = 0;
        
        // å ´æ™¯è¨­ç½®
        const SCENE_CONFIG = {
            fogColor: 0x0a0e1f,
            fogNear: 1,
            fogFar: 2000,
            ambientLight: 0x404040,
            directionalLight: 0x00ffff
        };

        // å»ºç¯‰ç‰©é…ç½®
        const BUILDING_CONFIG = [
            { id: 'main', pos: [0, 0, 0], size: [200, 120, 100], type: 'main', name: 'ä¸»ç”Ÿç”¢å» æˆ¿' },
            { id: 'line1', pos: [-150, 0, -200], size: [80, 60, 60], type: 'production', name: 'Aç·š-æ›å…‰è£½ç¨‹' },
            { id: 'line2', pos: [150, 0, -200], size: [80, 60, 60], type: 'production', name: 'Bç·š-è•åˆ»è£½ç¨‹' },
            { id: 'line3', pos: [-150, 0, 200], size: [80, 60, 60], type: 'production', name: 'Cç·š-å£“åˆè£½ç¨‹' },
            { id: 'line4', pos: [150, 0, 200], size: [80, 60, 60], type: 'production', name: 'Dç·š-æª¢æ¸¬è£½ç¨‹' },
            { id: 'storage', pos: [300, 0, 0], size: [100, 80, 80], type: 'storage', name: 'è‡ªå‹•åŒ–å€‰å„²' },
            { id: 'office', pos: [-300, 0, 0], size: [60, 100, 60], type: 'office', name: 'ç®¡ç†ä¸­å¿ƒ' }
        ];

        // åˆå§‹åŒ–å ´æ™¯
        function initScene() {
            // å‰µå»ºå ´æ™¯
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(SCENE_CONFIG.fogColor, SCENE_CONFIG.fogNear, SCENE_CONFIG.fogFar);

            // å‰µå»ºç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.set(500, 300, 500);

            // å‰µå»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0a0e1f, 1);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            // å‰µå»ºæ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 100;
            controls.maxDistance = 1500;

            // æ·»åŠ ç‡ˆå…‰
            setupLighting();

            // å‰µå»ºå»ºç¯‰ç‰©
            createBuildings();

            // å‰µå»ºåœ°é¢
            createGround();

            // å‰µå»ºç²’å­ç³»çµ±
            createParticleSystem();

            // å•Ÿå‹•å‹•ç•«
            animate();

            // éš±è—è¼‰å…¥ç•«é¢
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hide');
            }, 2000);
        }

        // è¨­ç½®ç‡ˆå…‰
        function setupLighting() {
            // ç’°å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(SCENE_CONFIG.ambientLight, 0.4);
            scene.add(ambientLight);

            // ä¸»æ–¹å‘å…‰
            const directionalLight = new THREE.DirectionalLight(SCENE_CONFIG.directionalLight, 0.8);
            directionalLight.position.set(300, 400, 300);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 1000;
            directionalLight.shadow.camera.left = -500;
            directionalLight.shadow.camera.right = 500;
            directionalLight.shadow.camera.top = 500;
            directionalLight.shadow.camera.bottom = -500;
            scene.add(directionalLight);

            // è¼”åŠ©å…‰æº
            const pointLight1 = new THREE.PointLight(0x00ffff, 0.6, 800);
            pointLight1.position.set(-200, 100, -200);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0x40e0d0, 0.6, 800);
            pointLight2.position.set(200, 100, 200);
            scene.add(pointLight2);
        }

        // å‰µå»ºå»ºç¯‰ç‰©
        function createBuildings() {
            BUILDING_CONFIG.forEach(config => {
                const building = createBuilding(config);
                buildings.push(building);
                scene.add(building);
            });
        }

        // å‰µå»ºå–®å€‹å»ºç¯‰ç‰©
        function createBuilding(config) {
            const group = new THREE.Group();
            const [width, height, depth] = config.size;
            const [x, y, z] = config.pos;

            // æ ¹æ“šé¡å‹å‰µå»ºä¸åŒçš„å»ºç¯‰
            switch (config.type) {
                case 'main':
                    createMainFactory(group, config);
                    break;
                case 'production':
                    createProductionLine(group, config);
                    break;
                case 'storage':
                    createStorageBuilding(group, config);
                    break;
                case 'office':
                    createOfficeBuilding(group, config);
                    break;
                default:
                    createBasicBuilding(group, config);
            }

            // è¨­ç½®ä½ç½®
            group.position.set(x, 0, z);
            group.userData = config;

            return group;
        }

        // å‰µå»ºä¸»å·¥å» 
        function createMainFactory(group, config) {
            const [width, height, depth] = config.size;
            
            // ä¸»é«”çµæ§‹
            const mainGeom = new THREE.BoxGeometry(width, height * 0.8, depth);
            const mainMat = new THREE.MeshPhongMaterial({ 
                color: 0x2a2a2a, 
                transparent: true, 
                opacity: 0.9,
                shininess: 30 
            });
            const mainMesh = new THREE.Mesh(mainGeom, mainMat);
            mainMesh.position.y = height * 0.4;
            mainMesh.castShadow = true;
            group.add(mainMesh);

            // å±‹é ‚çµæ§‹
            const roofGeom = new THREE.ConeGeometry(width * 0.6, height * 0.3, 8);
            const roofMat = new THREE.MeshPhongMaterial({ color: 0x404040 });
            const roofMesh = new THREE.Mesh(roofGeom, roofMat);
            roofMesh.position.y = height * 0.9;
            group.add(roofMesh);

            // ç…™å›ª
            for (let i = 0; i < 3; i++) {
                const chimneyGeom = new THREE.CylinderGeometry(3, 4, height * 0.4);
                const chimneyMat = new THREE.MeshPhongMaterial({ color: 0x333333 });
                const chimney = new THREE.Mesh(chimneyGeom, chimneyMat);
                chimney.position.set(
                    (i - 1) * width * 0.2, 
                    height * 1.1, 
                    depth * 0.3
                );
                group.add(chimney);
            }

            // çª—æˆ¶
            addWindows(group, width, height, depth, 0x00ffff);
            
            // ç®¡é“ç³»çµ±
            addPipingSystem(group, width, height, depth);
            
            // ç™¼å…‰é‚Šç·£
            addGlowingEdges(group, mainGeom, 0x00ffff, mainMesh.position);
        }

        // å‰µå»ºç”Ÿç”¢ç·š
        function createProductionLine(group, config) {
            const [width, height, depth] = config.size;
            
            // ä¸»é«” - æ›´å·¥æ¥­åŒ–çš„é€ å‹
            const mainGeom = new THREE.BoxGeometry(width, height * 0.7, depth);
            const mainMat = new THREE.MeshPhongMaterial({ 
                color: 0x1a1a2e, 
                metalness: 0.7,
                roughness: 0.3
            });
            const mainMesh = new THREE.Mesh(mainGeom, mainMat);
            mainMesh.position.y = height * 0.35;
            group.add(mainMesh);

            // è¨­å‚™è‰™é«”
            const equipGeom = new THREE.CylinderGeometry(width * 0.3, width * 0.25, height * 0.5);
            const equipMat = new THREE.MeshPhongMaterial({ color: 0x40e0d0, transparent: true, opacity: 0.7 });
            const equipMesh = new THREE.Mesh(equipGeom, equipMat);
            equipMesh.position.y = height * 0.65;
            group.add(equipMesh);

            // å‚³é€å¸¶
            const beltGeom = new THREE.BoxGeometry(width * 1.2, 2, 8);
            const beltMat = new THREE.MeshPhongMaterial({ color: 0x666666 });
            const belt = new THREE.Mesh(beltGeom, beltMat);
            belt.position.set(0, 3, depth * 0.6);
            group.add(belt);

            // æ©Ÿæ¢°è‡‚åŸºåº§
            for (let i = 0; i < 2; i++) {
                const armBaseGeom = new THREE.CylinderGeometry(5, 8, 15);
                const armBaseMat = new THREE.MeshPhongMaterial({ color: 0x00ff7f });
                const armBase = new THREE.Mesh(armBaseGeom, armBaseMat);
                armBase.position.set((i - 0.5) * width * 0.6, 10, 0);
                group.add(armBase);

                // æ©Ÿæ¢°è‡‚
                const armGeom = new THREE.CylinderGeometry(2, 3, 25);
                const armMat = new THREE.MeshPhongMaterial({ color: 0xffa500 });
                const arm = new THREE.Mesh(armGeom, armMat);
                arm.position.set((i - 0.5) * width * 0.6, 25, 10);
                arm.rotation.z = Math.PI / 6 * (i === 0 ? 1 : -1);
                group.add(arm);
            }

            // æ§åˆ¶é¢æ¿
            addControlPanels(group, width, height, depth);
            
            // ç™¼å…‰é‚Šç·£
            addGlowingEdges(group, mainGeom, 0x40e0d0, mainMesh.position);
        }

        // å‰µå»ºå€‰å„²å»ºç¯‰
        function createStorageBuilding(group, config) {
            const [width, height, depth] = config.size;
            
            // ä¸»å€‰åº«çµæ§‹
            const mainGeom = new THREE.BoxGeometry(width, height, depth);
            const mainMat = new THREE.MeshPhongMaterial({ 
                color: 0x0f3460, 
                transparent: true, 
                opacity: 0.8 
            });
            const mainMesh = new THREE.Mesh(mainGeom, mainMat);
            mainMesh.position.y = height / 2;
            group.add(mainMesh);

            // è²¨æ¶ç³»çµ±
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 3; j++) {
                    const rackGeom = new THREE.BoxGeometry(8, height * 0.8, 6);
                    const rackMat = new THREE.MeshPhongMaterial({ color: 0x666666 });
                    const rack = new THREE.Mesh(rackGeom, rackMat);
                    rack.position.set(
                        (i - 2) * width * 0.15,
                        height * 0.4,
                        (j - 1) * depth * 0.25
                    );
                    group.add(rack);
                }
            }

            // è‡ªå‹•åŒ–èµ·é‡æ©Ÿ
            const craneGeom = new THREE.BoxGeometry(width * 0.8, 4, 8);
            const craneMat = new THREE.MeshPhongMaterial({ color: 0xffa500 });
            const crane = new THREE.Mesh(craneGeom, craneMat);
            crane.position.y = height * 0.9;
            group.add(crane);

            // ç™¼å…‰é‚Šç·£
            addGlowingEdges(group, mainGeom, 0x00ff7f, mainMesh.position);
        }

        // å‰µå»ºè¾¦å…¬æ¨“
        function createOfficeBuilding(group, config) {
            const [width, height, depth] = config.size;
            
            // ä¸»é«”
            const mainGeom = new THREE.BoxGeometry(width, height, depth);
            const mainMat = new THREE.MeshPhongMaterial({ 
                color: 0x2d1b69, 
                transparent: true, 
                opacity: 0.85 
            });
            const mainMesh = new THREE.Mesh(mainGeom, mainMat);
            mainMesh.position.y = height / 2;
            group.add(mainMesh);

            // å¤šå±¤çª—æˆ¶
            for (let floor = 0; floor < 6; floor++) {
                for (let i = 0; i < 8; i++) {
                    const windowGeom = new THREE.PlaneGeometry(4, 6);
                    const windowMat = new THREE.MeshBasicMaterial({ 
                        color: 0xff6600, 
                        transparent: true, 
                        opacity: 0.6 
                    });
                    const window = new THREE.Mesh(windowGeom, windowMat);
                    window.position.set(
                        (i - 3.5) * 6,
                        10 + floor * 15,
                        width / 2 + 0.5
                    );
                    group.add(window);
                }
            }

            // å¤©ç·š
            const antennaGeom = new THREE.CylinderGeometry(0.5, 0.5, 20);
            const antennaMat = new THREE.MeshPhongMaterial({ color: 0xffffff });
            const antenna = new THREE.Mesh(antennaGeom, antennaMat);
            antenna.position.y = height + 15;
            group.add(antenna);

            // ç™¼å…‰é‚Šç·£
            addGlowingEdges(group, mainGeom, 0xff6600, mainMesh.position);
        }

        // æ·»åŠ çª—æˆ¶
        function addWindows(group, width, height, depth, color) {
            for (let i = 0; i < 12; i++) {
                const windowGeom = new THREE.PlaneGeometry(8, 12);
                const windowMat = new THREE.MeshBasicMaterial({ 
                    color: color, 
                    transparent: true, 
                    opacity: 0.4 
                });
                const window = new THREE.Mesh(windowGeom, windowMat);
                window.position.set(
                    (i - 5.5) * 15,
                    height * 0.5,
                    depth / 2 + 0.5
                );
                group.add(window);
            }
        }

        // æ·»åŠ ç®¡é“ç³»çµ±
        function addPipingSystem(group, width, height, depth) {
            for (let i = 0; i < 6; i++) {
                const pipeGeom = new THREE.CylinderGeometry(1.5, 1.5, width);
                const pipeMat = new THREE.MeshPhongMaterial({ color: 0x666666 });
                const pipe = new THREE.Mesh(pipeGeom, pipeMat);
                pipe.rotation.z = Math.PI / 2;
                pipe.position.set(0, height * 0.2 + i * 8, depth / 2 + 2);
                group.add(pipe);
            }
        }

        // æ·»åŠ æ§åˆ¶é¢æ¿
        function addControlPanels(group, width, height, depth) {
            const panelGeom = new THREE.BoxGeometry(12, 16, 2);
            const panelMat = new THREE.MeshPhongMaterial({ color: 0x1a1a1a });
            const panel = new THREE.Mesh(panelGeom, panelMat);
            panel.position.set(width * 0.4, 10, depth / 2 + 1);
            group.add(panel);

            // è¢å¹•
            const screenGeom = new THREE.PlaneGeometry(8, 6);
            const screenMat = new THREE.MeshBasicMaterial({ 
                color: 0x00ff00, 
                transparent: true, 
                opacity: 0.8 
            });
            const screen = new THREE.Mesh(screenGeom, screenMat);
            screen.position.set(width * 0.4, 12, depth / 2 + 2);
            group.add(screen);
        }

        // æ·»åŠ ç™¼å…‰é‚Šç·£
        function addGlowingEdges(group, geometry, color, position) {
            const edgeGeometry = new THREE.EdgesGeometry(geometry);
            const edgeMaterial = new THREE.LineBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.8,
                linewidth: 2
            });
            const edges = new THREE.LineSegments(edgeGeometry, edgeMaterial);
            edges.position.copy(position);
            group.add(edges);
        }

        // åŸºæœ¬å»ºç¯‰ï¼ˆå‚™ç”¨ï¼‰
        function createBasicBuilding(group, config) {
            const [width, height, depth] = config.size;
            
            const geometry = new THREE.BoxGeometry(width, height, depth);
            const material = new THREE.MeshPhongMaterial({ color: 0x404040 });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.y = height / 2;
            group.add(mesh);
        }

        // å‰µå»ºç»ç’ƒæè³ª
        function createGlassMaterial(color, opacity) {
            return new THREE.MeshPhongMaterial({
                color: color,
                transparent: true,
                opacity: opacity,
                shininess: 100,
                specular: 0x111111
            });
        }

        // å‰µå»ºåœ°é¢
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(1500, 1500);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x0a0a0a,
                transparent: true,
                opacity: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -5;
            ground.receiveShadow = true;
            scene.add(ground);

            // æ·»åŠ ç¶²æ ¼ç·š
            const gridHelper = new THREE.GridHelper(1500, 30, 0x00ffff, 0x40e0d0);
            gridHelper.position.y = -4;
            gridHelper.material.transparent = true;
            gridHelper.material.opacity = 0.3;
            scene.add(gridHelper);
        }

        // å‰µå»ºç²’å­ç³»çµ±
        function createParticleSystem() {
            const particleCount = 1000;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 1000;
                positions[i * 3 + 1] = Math.random() * 200;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 1000;

                colors[i * 3] = Math.random();
                colors[i * 3 + 1] = 1;
                colors[i * 3 + 2] = 1;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 2,
                transparent: true,
                opacity: 0.6,
                vertexColors: true,
                blending: THREE.AdditiveBlending
            });

            const particleSystem = new THREE.Points(geometry, material);
            scene.add(particleSystem);
            particles.push(particleSystem);
        }

        // å‹•ç•«å¾ªç’°
        function animate() {
            requestAnimationFrame(animate);

            if (animationEnabled) {
                // æ›´æ–°æ§åˆ¶å™¨
                controls.update();

                // æ—‹è½‰å»ºç¯‰ç‰©
                buildings.forEach((building, index) => {
                    if (building.userData.type === 'main') {
                        building.rotation.y += 0.001;
                    }
                });

                // æ›´æ–°ç²’å­
                particles.forEach(particle => {
                    particle.rotation.y += 0.002;
                });

                // æ›´æ–°å¯¦æ™‚æ•¸æ“š
                updateRealtimeData();
            }

            renderer.render(scene, camera);
        }

        // æ›´æ–°å¯¦æ™‚æ•¸æ“š
        function updateRealtimeData() {
            if (Math.random() < 0.01) { // 1% æ©Ÿç‡æ›´æ–°
                // éš¨æ©Ÿæ›´æ–°æ•¸æ“š
                const efficiency = 88 + Math.random() * 10;
                const temperature = 23 + Math.random() * 5;
                const powerUsage = 1200 + Math.random() * 100;

                document.getElementById('overallEfficiency').textContent = efficiency.toFixed(1) + '%';
                document.getElementById('efficiencyBar').style.width = efficiency + '%';
                document.getElementById('systemTemp').textContent = temperature.toFixed(1) + 'Â°C';
                document.getElementById('powerUsage').textContent = Math.round(powerUsage) + ' kW';
            }
        }

        // è¨­ç½®è¦–åœ–æ¨¡å¼
        function setViewMode(mode) {
            currentViewMode = mode;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // åˆ‡æ›è¦–è§’
            switch (mode) {
                case 'overview':
                    camera.position.set(500, 300, 500);
                    controls.target.set(0, 0, 0);
                    break;
                case 'production':
                    camera.position.set(0, 200, 400);
                    controls.target.set(0, 50, 0);
                    break;
                case 'quality':
                    camera.position.set(200, 150, 200);
                    controls.target.set(150, 30, 200);
                    break;
                case 'logistics':
                    camera.position.set(400, 100, 0);
                    controls.target.set(300, 40, 0);
                    break;
            }
            
            controls.update();
        }

        // èšç„¦è¨­å‚™
        function focusEquipment(equipmentId) {
            const building = buildings.find(b => b.userData.id === equipmentId);
            if (building) {
                const pos = building.userData.pos;
                camera.position.set(pos[0] + 100, 80, pos[2] + 100);
                controls.target.set(pos[0], 30, pos[2]);
                controls.update();
            }
        }

        // åˆ‡æ›å‹•ç•«
        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            event.target.textContent = animationEnabled ? 'å‹•ç•«æ•ˆæœ' : 'æ¢å¾©å‹•ç•«';
        }

        // å°å‡ºè¦–åœ–
        function exportView() {
            const link = document.createElement('a');
            link.download = `SmartFactory_${new Date().toISOString().slice(0, 19)}.png`;
            link.href = renderer.domElement.toDataURL();
            link.click();
        }

        // è‡ªå®šç¾©æ¸¸æ¨™
        function updateCustomCursor() {
            document.addEventListener('mousemove', function(e) {
                const cursor = document.getElementById('cursor');
                cursor.style.left = e.clientX - 10 + 'px';
                cursor.style.top = e.clientY - 10 + 'px';
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
        }

        // éŸ¿æ‡‰å¼èª¿æ•´
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // éµç›¤æ§åˆ¶
        function handleKeyboard() {
            document.addEventListener('keydown', function(e) {
                switch(e.code) {
                    case 'Digit1':
                        setViewMode('overview');
                        break;
                    case 'Digit2':
                        setViewMode('production');
                        break;
                    case 'Digit3':
                        setViewMode('quality');
                        break;
                    case 'Digit4':
                        setViewMode('logistics');
                        break;
                    case 'Space':
                        e.preventDefault();
                        toggleAnimation();
                        break;
                    case 'KeyS':
                        exportView();
                        break;
                }
            });
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            initScene();
            updateCustomCursor();
            handleKeyboard();
            window.addEventListener('resize', onWindowResize, false);
        });
    </script>
</body>
</html>