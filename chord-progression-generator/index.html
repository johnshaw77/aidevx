<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å’Œå¼¦é€²è¡Œç”Ÿæˆå™¨ | Chord Progression Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e1e2e, #2d1b69);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .control-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4ecdc4;
        }
        
        select, input[type="range"] {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 16px;
        }
        
        select option {
            background: #1e1e2e;
            color: #fff;
        }
        
        .range-value {
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .result {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }
        
        .chord-display {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .chord-progression {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 3px;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .chord-numbers {
            font-size: 1.2rem;
            color: #45b7d1;
            margin-bottom: 10px;
        }
        
        .analysis {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .analysis h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .analysis-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .analysis-item h4 {
            color: #ff6b6b;
            margin-bottom: 8px;
        }
        
        .chord-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .chord-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chord-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .chord-btn.playing {
            background: #ff6b6b;
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            color: #fff;
            text-decoration: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .home-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .control-row {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .chord-progression {
                font-size: 1.5rem;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">â† è¿”å›é¦–é </a>
    
    <div class="container">
        <div class="header">
            <h1>ğŸµ å’Œå¼¦é€²è¡Œç”Ÿæˆå™¨</h1>
            <p>å‰µé€ ç¾å¦™çš„éŸ³æ¨‚å’Œå¼¦åºåˆ—ï¼Œæ”¯æ´å¤šç¨®é¢¨æ ¼èˆ‡å³æ™‚æ’­æ”¾</p>
        </div>
        
        <div class="controls">
            <div class="control-row">
                <div class="control-group">
                    <label for="style">ğŸ¨ éŸ³æ¨‚é¢¨æ ¼</label>
                    <select id="style">
                        <option value="pop">æµè¡Œ Pop</option>
                        <option value="jazz">çˆµå£« Jazz</option>
                        <option value="rock">æ–æ»¾ Rock</option>
                        <option value="blues">è—èª¿ Blues</option>
                        <option value="classical">å¤å…¸ Classical</option>
                        <option value="funk">æ”¾å…‹ Funk</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="key">ğŸ¼ èª¿æ€§</label>
                    <select id="key">
                        <option value="C">C å¤§èª¿</option>
                        <option value="G">G å¤§èª¿</option>
                        <option value="D">D å¤§èª¿</option>
                        <option value="A">A å¤§èª¿</option>
                        <option value="E">E å¤§èª¿</option>
                        <option value="B">B å¤§èª¿</option>
                        <option value="F#">F# å¤§èª¿</option>
                        <option value="F">F å¤§èª¿</option>
                        <option value="Bb">Bb å¤§èª¿</option>
                        <option value="Eb">Eb å¤§èª¿</option>
                        <option value="Ab">Ab å¤§èª¿</option>
                        <option value="Db">Db å¤§èª¿</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="length">ğŸµ å’Œå¼¦æ•¸é‡</label>
                    <input type="range" id="length" min="4" max="8" value="4">
                    <div class="range-value" id="lengthValue">4 å€‹å’Œå¼¦</div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="generateProgression()">ğŸ² ç”Ÿæˆå’Œå¼¦é€²è¡Œ</button>
                <button class="btn btn-secondary" onclick="playProgression()">â–¶ï¸ æ’­æ”¾æ•´æ®µ</button>
                <button class="btn btn-secondary" onclick="stopPlaying()">â¹ï¸ åœæ­¢æ’­æ”¾</button>
            </div>
        </div>
        
        <div class="result" id="result" style="display: none;">
            <div class="chord-display">
                <div class="chord-progression" id="chordProgression"></div>
                <div class="chord-numbers" id="chordNumbers"></div>
            </div>
            
            <div class="chord-buttons" id="chordButtons"></div>
            
            <div class="analysis" id="analysis"></div>
        </div>
    </div>
    
    <script>
        // éŸ³æ¨‚ç†è«–è³‡æ–™
        const keys = {
            'C': ['C', 'Dm', 'Em', 'F', 'G', 'Am', 'Bdim'],
            'G': ['G', 'Am', 'Bm', 'C', 'D', 'Em', 'F#dim'],
            'D': ['D', 'Em', 'F#m', 'G', 'A', 'Bm', 'C#dim'],
            'A': ['A', 'Bm', 'C#m', 'D', 'E', 'F#m', 'G#dim'],
            'E': ['E', 'F#m', 'G#m', 'A', 'B', 'C#m', 'D#dim'],
            'B': ['B', 'C#m', 'D#m', 'E', 'F#', 'G#m', 'A#dim'],
            'F#': ['F#', 'G#m', 'A#m', 'B', 'C#', 'D#m', 'E#dim'],
            'F': ['F', 'Gm', 'Am', 'Bb', 'C', 'Dm', 'Edim'],
            'Bb': ['Bb', 'Cm', 'Dm', 'Eb', 'F', 'Gm', 'Adim'],
            'Eb': ['Eb', 'Fm', 'Gm', 'Ab', 'Bb', 'Cm', 'Ddim'],
            'Ab': ['Ab', 'Bbm', 'Cm', 'Db', 'Eb', 'Fm', 'Gdim'],
            'Db': ['Db', 'Ebm', 'Fm', 'Gb', 'Ab', 'Bbm', 'Cdim']
        };
        
        const progressionTemplates = {
            pop: [
                [0, 3, 5, 4], // I-IV-vi-V
                [0, 5, 3, 4], // I-vi-IV-V
                [5, 3, 0, 4], // vi-IV-I-V
                [0, 4, 5, 3, 0, 4, 5, 4], // I-V-vi-IV-I-V-vi-V
            ],
            jazz: [
                [0, 5, 1, 4], // Imaj7-vi7-ii7-V7
                [0, 0, 1, 4, 0], // Imaj7-Imaj7-ii7-V7-Imaj7
                [0, 6, 1, 4], // I-viiÂ°-ii-V
                [2, 4, 0], // iii-V-I
            ],
            rock: [
                [0, 6, 3, 4], // I-â™­VII-IV-V
                [0, 3, 4, 0], // I-IV-V-I
                [5, 3, 0, 4], // vi-IV-I-V
                [0, 2, 3, 4], // I-iii-IV-V
            ],
            blues: [
                [0, 0, 0, 0, 3, 3, 0, 0, 4, 3, 0, 4], // 12-bar blues
                [0, 3, 0, 4], // I-IV-I-V
                [0, 3, 4, 0], // I-IV-V-I
            ],
            classical: [
                [0, 4, 0, 4, 0], // I-V-I-V-I
                [0, 1, 4, 0], // I-ii-V-I
                [0, 3, 1, 4, 0], // I-IV-ii-V-I
                [0, 5, 3, 4, 0], // I-vi-IV-V-I
            ],
            funk: [
                [0, 6, 3, 1], // I-â™­VII-IV-ii
                [0, 3, 0, 6], // I-IV-I-â™­VII
                [5, 3, 1, 4], // vi-IV-ii-V
                [0, 1, 0, 1], // I-ii-I-ii
            ]
        };
        
        const styleDescriptions = {
            pop: "æ˜äº®ã€æœ—æœ—ä¸Šå£çš„æµè¡ŒéŸ³æ¨‚æ„Ÿï¼Œé©åˆä¸»æµéŸ³æ¨‚å‰µä½œ",
            jazz: "è¤‡é›œã€æˆç†Ÿçš„å’Œè²è‰²å½©ï¼Œå……æ»¿å³èˆˆèˆ‡è®ŠåŒ–",
            rock: "å¼·å‹æœ‰åŠ›çš„æ–æ»¾é¢¨æ ¼ï¼Œé©åˆç¯€å¥æ˜å¿«çš„æ­Œæ›²",
            blues: "æ†‚é¬±æ·±æƒ…çš„è—èª¿è‰²å½©ï¼Œè¡¨é”è±å¯Œçš„æƒ…æ„Ÿ",
            classical: "å„ªé›…èŠåš´çš„å¤å…¸å’Œè²ï¼Œçµæ§‹å®Œæ•´å¹³è¡¡",
            funk: "ç¯€å¥æ„Ÿå¼·çƒˆçš„æ”¾å…‹é¢¨æ ¼ï¼Œé©åˆå¾‹å‹•è±å¯Œçš„éŸ³æ¨‚"
        };
        
        let currentProgression = [];
        let audioContext = null;
        let isPlaying = false;
        
        // åˆå§‹åŒ– Web Audio API
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // å’Œå¼¦é »ç‡å°ç…§è¡¨ (ç°¡åŒ–ç‰ˆ)
        const noteFrequencies = {
            'C': 261.63, 'C#': 277.18, 'Db': 277.18, 'D': 293.66, 'D#': 311.13, 'Eb': 311.13,
            'E': 329.63, 'F': 349.23, 'F#': 369.99, 'Gb': 369.99, 'G': 392.00, 'G#': 415.30,
            'Ab': 415.30, 'A': 440.00, 'A#': 466.16, 'Bb': 466.16, 'B': 493.88
        };
        
        // æ’­æ”¾å’Œå¼¦
        function playChord(chordName, duration = 1.0) {
            if (!audioContext) return;
            
            const now = audioContext.currentTime;
            const gainNode = audioContext.createGain();
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
            
            // ç°¡åŒ–çš„å’Œå¼¦æ§‹æˆ
            const root = chordName.replace(/[^A-G#b]/g, '');
            const rootFreq = noteFrequencies[root] || 261.63;
            
            // æ’­æ”¾æ ¹éŸ³ã€ä¸‰åº¦ã€äº”åº¦
            [1, 1.25, 1.5].forEach((ratio, index) => {
                const oscillator = audioContext.createOscillator();
                oscillator.frequency.setValueAtTime(rootFreq * ratio, now);
                oscillator.type = 'sine';
                oscillator.connect(gainNode);
                oscillator.start(now);
                oscillator.stop(now + duration);
            });
        }
        
        // æ›´æ–°æ»‘æ¡¿é¡¯ç¤º
        document.getElementById('length').addEventListener('input', function() {
            document.getElementById('lengthValue').textContent = this.value + ' å€‹å’Œå¼¦';
        });
        
        // ç”Ÿæˆå’Œå¼¦é€²è¡Œ
        function generateProgression() {
            const style = document.getElementById('style').value;
            const key = document.getElementById('key').value;
            const length = parseInt(document.getElementById('length').value);
            
            const keyChords = keys[key];
            const templates = progressionTemplates[style];
            const template = templates[Math.floor(Math.random() * templates.length)];
            
            // èª¿æ•´æ¨¡æ¿é•·åº¦
            let progression = [];
            if (template.length >= length) {
                progression = template.slice(0, length);
            } else {
                progression = template;
                while (progression.length < length) {
                    progression.push(template[Math.floor(Math.random() * template.length)]);
                }
            }
            
            currentProgression = progression.map(index => keyChords[index]);
            
            displayProgression(key, style);
        }
        
        // é¡¯ç¤ºå’Œå¼¦é€²è¡Œ
        function displayProgression(key, style) {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            
            // é¡¯ç¤ºå’Œå¼¦
            document.getElementById('chordProgression').textContent = currentProgression.join(' - ');
            
            // é¡¯ç¤ºç´šæ•¸
            const romanNumerals = ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'viiÂ°'];
            const numbers = currentProgression.map(chord => {
                const index = keys[key].indexOf(chord);
                return romanNumerals[index] || chord;
            });
            document.getElementById('chordNumbers').textContent = 'ç´šæ•¸: ' + numbers.join(' - ');
            
            // å‰µå»ºå’Œå¼¦æŒ‰éˆ•
            const buttonsHtml = currentProgression.map((chord, index) => 
                `<button class="chord-btn" onclick="playChordButton('${chord}', ${index})">${chord}</button>`
            ).join('');
            document.getElementById('chordButtons').innerHTML = buttonsHtml;
            
            // é¡¯ç¤ºåˆ†æ
            displayAnalysis(key, style);
        }
        
        // é¡¯ç¤ºæ¨‚ç†åˆ†æ
        function displayAnalysis(key, style) {
            const analysisHtml = `
                <h3>ğŸ¼ æ¨‚ç†åˆ†æ</h3>
                <div class="analysis-grid">
                    <div class="analysis-item">
                        <h4>èª¿æ€§</h4>
                        <p>${key} å¤§èª¿ (${key} Major)</p>
                    </div>
                    <div class="analysis-item">
                        <h4>é¢¨æ ¼ç‰¹è‰²</h4>
                        <p>${styleDescriptions[style]}</p>
                    </div>
                    <div class="analysis-item">
                        <h4>å’Œå¼¦åŠŸèƒ½</h4>
                        <p>ä¸»å’Œå¼¦: ${keys[key][0]} | å±¬å’Œå¼¦: ${keys[key][4]} | ä¸‹å±¬å’Œå¼¦: ${keys[key][3]}</p>
                    </div>
                    <div class="analysis-item">
                        <h4>å‰µä½œå»ºè­°</h4>
                        <p>${getCreativeSuggestion(style)}</p>
                    </div>
                </div>
            `;
            document.getElementById('analysis').innerHTML = analysisHtml;
        }
        
        // ç²å–å‰µä½œå»ºè­°
        function getCreativeSuggestion(style) {
            const suggestions = {
                pop: "å¯ä»¥åœ¨ç¬¬äºŒå’Œç¬¬å››æ‹åŠ å…¥ç¯€å¥å‰ä»–ï¼Œä½¿ç”¨æ˜äº®çš„éŸ³è‰²",
                jazz: "å˜—è©¦åŠ å…¥ä¸ƒå’Œå¼¦çš„å»¶ä¼¸éŸ³ï¼Œå¦‚ 9th, 11th, 13th",
                rock: "ä½¿ç”¨ç ´éŸ³å‰ä»–æ¼”å¥ï¼Œæ­é…å¼·å‹çš„é¼“é»",
                blues: "å¯ä»¥åŠ å…¥è—èª¿éŸ³éšçš„æ—‹å¾‹ç·šï¼Œå¢æ·»æ†‚é¬±æ„Ÿ",
                classical: "é©åˆç”¨é‹¼ç´æˆ–å¼¦æ¨‚æ¼”å¥ï¼Œæ³¨æ„è²éƒ¨çš„æµå‹•",
                funk: "å¼·èª¿ç¯€æ‹çš„åˆ‡åˆ†éŸ³ï¼Œçªå‡ºå¾‹å‹•æ„Ÿ"
            };
            return suggestions[style] || "ç™¼æ®å‰µæ„ï¼ŒåŠ å…¥è‡ªå·±çš„éŸ³æ¨‚æƒ³æ³•ï¼";
        }
        
        // æ’­æ”¾å–®å€‹å’Œå¼¦
        function playChordButton(chordName, index) {
            initAudio();
            playChord(chordName);
            
            // è¦–è¦ºå›é¥‹
            const buttons = document.querySelectorAll('.chord-btn');
            buttons[index].classList.add('playing');
            setTimeout(() => {
                buttons[index].classList.remove('playing');
            }, 500);
        }
        
        // æ’­æ”¾æ•´æ®µå’Œå¼¦é€²è¡Œ
        function playProgression() {
            if (currentProgression.length === 0) {
                alert('è«‹å…ˆç”Ÿæˆå’Œå¼¦é€²è¡Œï¼');
                return;
            }
            
            initAudio();
            isPlaying = true;
            
            currentProgression.forEach((chord, index) => {
                setTimeout(() => {
                    if (isPlaying) {
                        playChordButton(chord, index);
                    }
                }, index * 1000); // æ¯ç§’ä¸€å€‹å’Œå¼¦
            });
            
            // æ’­æ”¾çµæŸå¾Œé‡ç½®ç‹€æ…‹
            setTimeout(() => {
                isPlaying = false;
            }, currentProgression.length * 1000);
        }
        
        // åœæ­¢æ’­æ”¾
        function stopPlaying() {
            isPlaying = false;
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            // ç”Ÿæˆä¸€å€‹é»˜èªå’Œå¼¦é€²è¡Œ
            generateProgression();
        };
    </script>
</body>
</html>